(()=>{var t,s={427:(e,t,s)=>{const i=s(9980),{clampNumber:n,logEvent:o}=s(4909),r=s(3698),{circleManager:a}=s(9220),l=s(3832);class h{constructor({id:e,x:t,y:s,size:i,flags:n,texture:o}){this.texture=o||a.get(0),this.id=e||0;const r=this.sprite=new l.Sprite(this.texture);r.anchor.set(.5),r.gameData=this,this.x=this.ox=r.position.x=t,this.nx,this.y=this.oy=r.position.y=s,this.ny,this.oSize=this.size=i,this.nSize,this.flags=n,this.destroyed=!1,this.updateStamp,this.scale}update(){const e=i.timeStamp-this.updateStamp,t=n(e/r.drawDelay,0,1);this.x=t*this.scale*(this.nx-this.ox)+this.ox,this.y=t*this.scale*(this.ny-this.oy)+this.oy;const s=2*(this.size=t*(this.nSize-this.oSize)+this.oSize),{sprite:o}=this;if(!o)return!1;if(this.texture.clearedFromCache)return!0;const{position:a}=o;return a.x===this.x&&a.y===this.y&&o.width===s||(a.x=this.x,a.y=this.y,o.width=o.height=s,this.onUpdate&&this.onUpdate(),!1)}destroy(e){if(this.destroyed)return void o(1,`Cell #${this.id} already destroyed!`);this.onDestroy&&this.onDestroy();const{cells:t}=i;t.delete(this.id),this.destroyed=!0,e?i.destroyedCells.add(this):this.destroySprite()}destroySprite(){this.sprite?(this.sprite.destroy(),this.sprite=null):o(1,`Sprite for cell #${this.id} already destroyed!`)}}h.prototype.updateStamp=0,h.prototype.scale=1,e.exports=h},7359:(e,t,s)=>{const i=s(427),n=s(3832);s(2426);class o extends i{constructor(e){e.texture=n.Texture.from("/img/coin.png"),super(e)}}o.prototype.type=9,o.prototype.isCoin=!0,e.exports=o},4276:e=>{const t=[16711680,16744448,16776960,8453888,65280,65408,65535,33023,8388863,16711935,16711808],s=t.map((e=>(.5*(e>>16&255)<<16|.5*(e>>8&255)<<8|.5*(255&e))>>0));e.exports={neon:[16776960,65280,65535,16711935],basic:t,basicd:s}},5435:(e,t,s)=>{const i=s(427),n=s(3832);class o extends i{constructor(e){e.texture=n.Texture.from("/img/crown.png"),super(e),this.sprite.alpha=.7}}o.prototype.type=6,o.prototype.isCrown=!0,e.exports=o},9269:(e,t,s)=>{const i=s(427),{circleManager:n,squareManager:o}=s(9220);class r extends i{constructor(e,t,s){e.texture=(s?o:n).get(t||4210752),super(e),this.sprite.alpha=.5}}r.prototype.type=5,r.prototype.isDead=!0,e.exports=r},419:(e,t,s)=>{s(9980);const i=s(3698),n=s(427),{circleManager:o}=s(9220),{clampNumber:r}=s(4909),a=()=>o.get(parseInt(i.ejectedColor,16));class l extends n{constructor(e){e.texture=a(),super(e)}reloadTexture(){this.sprite.texture=this.texture=a()}}l.prototype.type=3,l.prototype.isEjected=!0,e.exports=l},6099:(e,t,s)=>{const{circleManager:i}=s(9220),{neon:n}=s(4276),o=s(427),r=s(3698),a=e=>i.get(r.useFoodColor?parseInt(r.foodColor,16):n[e%n.length]);class l extends o{constructor(e){e.texture=a(e.id),super(e)}reloadTexture(){this.sprite.texture=this.texture=a(this.id)}}l.prototype.type=4,l.prototype.isFood=!0,e.exports=l},2049:(e,t,s)=>{const i=s(9287),n=s(3277),o=s(419),r=s(6099),a=s(9269),l=s(5435),h=s(7359);e.exports={PlayerCell:i,Virus:n,EjectedMass:o,Food:r,DeadCell:a,Crown:l,Coin:h}},9287:(e,t,s)=>{const i=s(9980),n=s(3698),o=s(427),{logEvent:r}=(s(3915),s(4909)),a=s(3832);class l extends o{constructor(e,t){super(e),this.player=t,this.pid=t.pid;const{ownedCells:s}=i;t.isMe&&s.add(this),t.hasCrown&&this.addCrown()}addCrown(){if(this.crownSprite)return void r(1,"addCrown(): crown already exists");const e=i.crownPool;let t;e.length?t=e.pop():(t=a.Sprite.from("/img/crown.png"),t.scale.set(.7),t.pivot.set(0,643),t.anchor.x=.5,t.rotation=-.5,t.alpha=.7,t.zIndex=2),this.crownSprite=t,this.sprite.addChild(t)}removeCrown(){const e=this.crownSprite;e?(this.sprite.removeChild(e),i.crownPool.push(e),this.crownSprite=null):r(1,"removeCrown(): crown doesnt exist")}onUpdate(){const e=i.scene.container.scale.x*this.size*i.renderer.resolution,t=e>n.smallTextThreshold,{player:s}=this;t&&(s.massShown&&!this.massText&&(this.massText=i.massTextPool.pop()||(e=>{const t=new a.BitmapText("",{fontName:"mass",align:"right"}),s=e.strokeThickness||0;return t.position.set(-s/2,-s/2),t.anchor.set(.5,-.6),t})(n.massTextStyle),this.massText.zIndex=0,this.sprite.addChild(this.massText)),s.nameShown&&!this.nameSprite&&s.nameSprite&&(this.nameSprite=new a.Sprite(s.nameSprite.texture),this.nameSprite.anchor.set(.5),this.nameSprite.zIndex=1,this.sprite.addChild(this.nameSprite))),this.crownSprite&&(this.crownSprite.visible=e>16&&n.showCrown),this.nameSprite&&(this.nameSprite.visible=s.nameShown&&t);const{massText:o}=this;o&&(s.massShown&&t?(o.text=i.getMassText(this.nSize*this.nSize/100),o.visible=!0):o.visible&&(o.visible=!1))}onDestroy(){const{ownedCells:e}=i;e.has(this)&&e.delete(this),this.massText&&(this.sprite.removeChild(this.massText),i.massTextPool.push(this.massText)),this.crownSprite&&this.removeCrown()}}l.prototype.type=1,l.prototype.isPlayerCell=!0,e.exports=l},3277:(e,t,s)=>{const i=s(427),{virusTexture:n}=s(9220),o=s(3832);class r extends i{constructor(e){e.texture=n.get(),super(e)}resetTexture(){this.destroySprite(),this.texture=n.get(),this.sprite=new o.Sprite(this.texture),this.sprite.anchor.set(.5),this.sprite.gameData=this}}r.prototype.type=2,r.prototype.isVirus=!0,e.exports=r},8733:(e,t,s)=>{const i=s(9980),n=s(9202),o=s(2631),r=(s(3915),s(5315)),a=s(3698),l=s(4547),{writeClientData:h,clampNumber:d}=s(4909);class c{spectate(e){if(l.alive)return!1;i.spectating=!0;const t=o.fromSize(e?3:1);t.writeUInt8(2),e&&t.writeInt16LE(e),n.send(t)}join(){const e=o.fromSize(1);e.writeUInt8(1),h(e),n.send(e)}spectateLockToggle(){n.sendOpcode(10)}feed(e){const t=!!arguments.length,s=o.fromSize(t?2:1);s.writeUInt8(21),t&&s.writeUInt8(+e),n.send(s)}freezeMouse(e){i.running&&(void 0===e&&(e=!i.mouseFrozen),e&&(this.stopMovement(!1),this.lockLinesplit(!1),i.updateMouse(!0),n.sendMouse()),i.mouseFrozen=e,i.emit("update-cautions",{mouseFrozen:e}))}stopMovement(e){i.running&&(void 0===e&&(e=!i.moveToCenterOfCells),e&&(this.freezeMouse(!1),this.lockLinesplit(!1)),this.moveToCenterOfCells=e,i.emit("update-cautions",{moveToCenterOfCells:e}))}lockLinesplit(e){i.running&&(void 0===e&&(e=!i.stopMovePackets),e&&(i.updateMouse(),n.sendMouse(),n.sendOpcode(15),this.freezeMouse(!1),this.stopMovement(!1)),i.stopMovePackets=e,i.emit("update-cautions",{lockLinesplit:e}))}linesplit(){this.linesplitUnlock&&clearTimeout(this.linesplitUnlock),this.freezeMouse(!0),this.split(3),this.linesplitUnlock=setTimeout((()=>{delete this.linesplitUnlock,this.freezeMouse(!1)}),1500)}split(e,t=0){if(i.stopMovePackets||n.sendMouse(),t)return void setTimeout((()=>this.split(e)),t);const s=o.fromSize(2);s.writeUInt8(17),s.writeUInt8(e),n.send(s),i.splitCount+=e,i.splitCount<=2?i.moveWaitUntil=performance.now()+300:(i.moveWaitUntil=0,i.splitCount=0)}zoom(e){const t=1-a.cameraZoomSpeed/100;let s=0;e.detail?s=e.detail/3:e.wheelDelta&&(s=e.wheelDelta/-120);const n=Math.pow(t,s);i.mouseZoom=d(i.mouseZoom*n,i.mouseZoomMin,1)}setZoomLevel(e){i.mouseZoom=.8/Math.pow(2,e-1)}findPlayerUnderMouse(e){const{x:t,y:s}=i.mouse;let n=0,o=null;return[...i.cells.values()].filter((e=>!!e.isPlayerCell)).sort(((e,t)=>e.size-t.size)).forEach((i=>{const r=i.x-t,a=i.y-s,l=Math.sqrt(Math.abs(r*r+a*a))-i.size;e?l<n&&(n=l,o=i):l<=0&&(n=i.size,o=i)})),o}toggleSkins(e){void 0===e&&(e=!a.skinsEnabled),a.set("skinsEnabled",e),r.invalidateVisibility()}toggleNames(e){void 0===e&&(e=!a.namesEnabled),a.set("namesEnabled",e),r.invalidateVisibility()}toggleMass(e){void 0===e&&(e=!a.massEnabled),a.set("massEnabled",e),r.invalidateVisibility()}toggleFood(e){void 0===e&&(e=!a.foodVisible),a.set("foodVisible",e),i.scene.food.visible=e}toggleHud(e){void 0===e&&(e=!a.showHud),a.set("showHud",e),i.app.showHud=e}toggleChat(e){void 0===e&&(e=!a.showChat),a.set("showChat",e),i.running&&i.emit("chat-visible",{visible:e})}toggleChatToast(){void 0===state&&(state=!a.showChatToast),a.set("showChatToast",state),i.running&&i.emit("chat-visible",{visibleToast:state})}}const p=new c;s.g.actionManager=p,t.ActionManager=c,e.exports=p},4893:(e,t,s)=>{const i=s(9980),n=s(3698),o=s(9575).view,r=s(2766),a=s(8913),l=s(8733),h=new Set;let d=!1;window.addEventListener("blur",(()=>h.clear()));const c=e=>(e.preventDefault(),e.returnValue="Are you sure you want to close the page?");i.on("game-stopped",(()=>{window.removeEventListener("beforeunload",c,{capture:!0}),d=!1})),i.on("game-started",(()=>{window.addEventListener("beforeunload",c,{capture:!0}),d=!0})),window.addEventListener("resize",(()=>{d&&i.scene.setPosition()})),o.addEventListener("mousedown",(e=>{if(!d)return;if(e.preventDefault(),o.focus(),i.spectating&&0===e.button){const e=l.findPlayerUnderMouse();return void(e&&l.spectate(e.pid))}const t="MOUSE"+e.button;a.press(t)})),o.addEventListener("mouseup",(e=>{if(!d)return;const t=`MOUSE${e.button}`;h.delete(t),a.release(t)})),o.addEventListener("mousemove",(e=>{if(!d)return;const t=new r(e.clientX,e.clientY);if(n.mouseFreezeSoft){const{x:e,y:s}=i.rawMouse;t.x===e&&t.y===s||l.freezeMouse(!1)}i.rawMouse.set(t),i.updateMouse()})),o.addEventListener("wheel",(e=>{d&&l.zoom(e)}),{passive:!0}),document.body.addEventListener("keydown",(e=>{if(!d)return;const t=e.target===o;if(!t&&e.target!==document.body)return;const s=a.convertKey(e.code);e.ctrlKey&&"TAB"===s||h.has(s)||(h.add(s),"ESCAPE"===s?i.replaying?(h.clear(),i.stop(),i.showMenu(!0)):i.deathTimeout?i.triggerAutoRespawn():i.showMenu():"ENTER"===s?i.emit("chat-focus"):t&&a.press(s)&&e.preventDefault())})),document.body.addEventListener("keyup",(e=>{if(!d)return;const t=a.convertKey(e.code);h.delete(t),a.release(t)}))},9980:(e,t,s)=>{const i=s(4547),n=s(3698),o=s(9575),{virusTexture:r,squareManager:a,circleManager:l}=s(9220),h=s(2068),d=s(6412),c=s(2766),{clampNumber:p,lerp:u,logEvent:m}=s(4909),{EventEmitter:g}=s(7187),w=s(3832);class y extends g{constructor(){super(),this.running=!1,this.protocol,this.gamemodeId,this.instanceSeed,this.replaying,this.playerId,this.multiboxPid,this.activePid,this.tagId,this.spectating=!1,this.alive=i.alive=!1,this.score=0,this.highestScore=0,this.serverTick,this.clientVersion=20,this.renderer=o,this.skinLoader=new d,r.load(n.virusImageUrl),this.settings=n,this.timeStamp,this.pingStamp,this.state=i,this.connection,this.actions,this.cells=new Map,this.cellCount=0,this.ownedCells=new Set,this.destroyedCells=new Set,this.rawMouse=new c,this.mouse=new c,this.mouseZoom,this.mouseZoomMin,this.border,this.food,this.camera,this.massTextPool=[],this.crownPool=[],this.scene,this.playerManager,this.ticker=null,this.splitCount=0,this.moveWaitUntil,this.stopMovePackets,this.mouseFrozen,this.moveInterval;const e=this.intervals=[];e.push(setInterval((()=>this.emit("every-second")),1e3)),e.push(setInterval((()=>this.emit("every-minute")),6e4)),this.app,this.ticksSinceDeath,this.deathTimeout}start(e){if(!(e.protocol&&e.instanceSeed&&e.playerId&&e.border))throw new Error("Lacking mandatory data");this.running=!0,this.protocol=e.protocol,this.gamemodeId=e.gamemodeId||0,this.instanceSeed=e.instanceSeed,this.replaying=!1,this.playerId=e.playerId,this.multiboxPid=null,this.activePid=e.playerId,this.tagId=null,this.spectating=!1,this.alive=i.alive=!1,this.score=0,this.highestScore=0,this.serverTick=0,this.timeStamp=0,this.pingStamp=0,this.cells.clear(),this.cellCount=0,this.ownedCells.clear(),this.destroyedCells.clear(),this.rawMouse.reset(),this.mouse.reset(),this.mouseZoom=.3,this.mouseZoomMin=.01;const t=this.border=e.border;this.food=e.food,this.camera={timeStamp:0,spectator:new c,oldPosition:new c(t.x,t.y),newPosition:new c(t.x,t.y),oldScale:this.mouseZoom,newScale:this.mouseZoom},this.massTextPool=[],this.crownPool=[],this.scene=new h(this,t),this.playerManager.reset(),this.ticker=new w.Ticker,this.ticker.add(this.onTick.bind(this)),i.selectedServer&&i.connectionUrl!==i.selectedServer.url&&(i.selectedServer=null),this.replaying||(this.splitCount=0,this.moveWaitUntil=0,this.stopMovePackets=!1,this.moveToCenterOfCells=!1,this.mouseFrozen=!1,n.minimapEnabled,n.showChat,this.emit("leaderboard-show"),this.emit("stats-visible"),this.moveInterval=setInterval((()=>{if(!this.stopMovePackets)return this.moveToCenterOfCells?this.connection.sendOpcode(9):void this.connection.sendMouse()}),40),i.interactible=!0,this.on("every-second",y.everySecond)),this.frames=0,this.ticker.start(),this.emit("game-started")}stop(){if(!this.running)return;this.running=!1,delete this.protocol,delete this.gamemodeId,delete this.instanceSeed,delete this.replaying,delete this.playerId,delete this.multiboxPid,delete this.activePid,delete this.tagId,this.spectating=!1,this.alive=i.alive=!1,i.spectators=0,i.interactible=!1,i.playButtonDisabled=!1,i.playButtonText="Play",this.score=0,this.highestScore=0,this.serverTick=0,this.timeStamp=0,this.pingStamp=0,this.clearCells(),console.log(this.cells,this.ownedCells,this.destroyedCells),this.rawMouse.reset(),this.mouse.reset(),delete this.mouseZoom,delete this.mouseZoomMin,delete this.border,delete this.food,delete this.camera,this.playerManager.reset();const{scene:e}=this;e&&(e.destroyBackgroundImage(!1),e.uninstallMassTextFont(),e.container.destroy({children:!0}),delete this.scene),this.renderer.clear(),a.reset(),l.reset();let t=this.massTextPool;for(;t.length;)t.pop().destroy(!0);for(delete this.massTextPool,t=this.crownPool;t.length;)t.pop().destroy();delete this.crownPool,delete this.splitCount,delete this.moveWaitUntil,delete this.stopMovePackets,delete this.moveToCenterOfCells,delete this.mouseFrozen,clearInterval(this.moveInterval),delete this.moveInterval,this.off("every-second",y.everySecond),this.skinLoader.clearCallbacks(),this.emit("minimap-stats-visible",!0),this.emit("stats-visible",!1),this.emit("chat-visible",{visible:!1}),this.emit("leaderboard-hide"),this.emit("minimap-hide"),this.emit("minimap-destroy"),this.emit("show-replay-controls",!1),this.emit("cells-changed",0),this.emit("reset-cautions"),delete this.frames,this.ticker.stop(),delete this.ticker,this.emit("game-stopped")}static everySecond(){S.pingStamp=performance.now(),S.connection.sendOpcode(3)}showMenu(e){const{app:t}=this;if(void 0===e&&(e=!t.showMenu),t.showMenu=e,m(0,"Menu "+(e?"opened":"closed")),e)this.emit("menu-opened");else{const e=document.activeElement;e&&"chatbox-input"!==e.id&&o.view.focus(),this.stopMovePackets=!1}return e}clearCells(){this.cells.forEach((e=>e.destroy()));const{destroyedCells:e}=this;let t;for(t of e.values())t.destroySprite();e.clear()}triggerAutoRespawn(){i.deathDelay=!1,i.autoRespawning=!1,this.actions.join(),delete this.ticksSinceDeath}triggerDeathDelay(){clearTimeout(this.deathTimeout),delete this.deathTimeout,i.deathDelay=!1,i.isAutoRespawning=!1,this.showMenu(!1),this.app.showDeathScreen=!0}onTick(e){(this.timeStamp=performance.now())>=this.moveWaitUntil&&(this.updateMouse(),this.splitCount=0);const{destroyedCells:t,cells:s}=this,i=[...t.values(),...s.values()],n=i.length;let r=0;for(;r<n;){const e=i[r++];e.update()&&t.has(e)&&(e.destroySprite(),t.delete(e))}this.scene.sort();const a=this.updateCamera(!1);NaN!=a?(this.score=a,this.highestScore=Math.max(a,this.highestScore||0)):(this.score=0,this.highestScore=0),o.render(this.scene.container),this.frames++}updateCamera(e){const{camera:t}=this,{oldPosition:s,newPosition:i}=t,o=this.timeStamp-t.timeStamp,r=p(o/n.cameraMoveDelay,0,1),a=p(o/n.cameraZoomDelay,0,1),l=this.scene.container,h=s.copy().lerp(i,r);l.pivot.set(h.x,h.y);const d=u(t.oldScale,t.newScale,a);l.scale.set(d);let m,g,w=this.mouseZoom;if(this.spectating)m=t.spectator,g=NaN;else{m=new c(0,0);const{ownedCells:e}=this;if(0!=e.size){let t,s=0;for(t of e){const e=Math.round(Math.pow(t.nSize/10,2));m.add(t.nx*e,t.ny*e),g+=e,s+=t.nSize}m.divide(g),n.autoZoom&&(w*=Math.pow(Math.min(64/s,1),.27))}else m.set(i)}if(!e)return g;s.set(h),t.oldScale=d,i.set(m),t.newScale=w,t.timeStamp=this.timeStamp}updateMouse(e=!1){if(this.mouseFrozen&&!e)return;const t=this.scene.container,{rawMouse:s,mouse:i}=this;i.set(p(t.pivot.x+(s.x-window.innerWidth/2)/t.scale.x,-32768,32767),p(t.pivot.y+(s.y-window.innerHeight/2)/t.scale.y,-32768,32767))}seededRandom(e){return(e=Math.sin(e)*(1e4+this.instanceSeed))-Math.floor(e)}setTagId(e){return(e=e||0)!==this.tagId&&(this.tagId=e,!0)}getMassText(e){return!n.shortMass||e<1e3?e.toFixed(0):(e/1e3).toFixed(1)+"k"}}const S=new y;s.g.gameObject=S,e.exports=S},8913:(e,t,s)=>{const i=s(9980),n=s(8733),o=s(3698),r=s(4547),{logEvent:a}=s(4909),l=new Map([["toggleAutoRespawn",()=>{const e=o.autoRespawn;o.set("autoRespawn",!e),e&&r.isAutoRespawning&&i.triggerDeathDelay(!0),Swal.toast.fire({title:"Auto respawn "+(e?"disabled":"enabled"),type:"info",timer:1500})}],["respawn",()=>{r.deathDelay||r.playButtonDisabled||(n.join(),i.showMenu(!1))}],["feed",n.feed.bind(n)],["feedMacro",n.feed.bind(n,!0)],["split",n.split.bind(n,1)],["splitx2",()=>n.split(2,o.delayDoublesplit?40:0)],["splitx3",n.split.bind(n,3)],["splitMax",n.split.bind(n,4)],["split32",n.split.bind(n,5)],["split64",n.split.bind(n,6)],["split128",n.split.bind(n,7)],["split256",n.split.bind(n,8)],["linesplit",n.linesplit.bind(n)],["freezeMouse",n.freezeMouse.bind(n)],["lockLinesplit",n.lockLinesplit.bind(n)],["stopMovement",n.stopMovement.bind(n)],["toggleSkins",n.toggleSkins.bind(n)],["toggleNames",n.toggleNames.bind(n)],["toggleFood",n.toggleFood.bind(n)],["toggleMass",n.toggleMass.bind(n)],["toggleChat",n.toggleChat.bind(n)],["toggleChatToast",n.toggleChatToast.bind(n)],["toggleHud",n.toggleHud.bind(n)],["spectateLock",n.spectateLockToggle.bind(n)],["zoomLevel1",n.setZoomLevel.bind(n,1)],["zoomLevel2",n.setZoomLevel.bind(n,2)],["zoomLevel3",n.setZoomLevel.bind(n,3)],["zoomLevel4",n.setZoomLevel.bind(n,4)],["zoomLevel5",n.setZoomLevel.bind(n,5)]]),h={feed:"W",feedMacro:"MOUSE0",split:"SPACE",splitx2:"G",splitx3:"H",splitMax:"T",split32:"",split64:"",linesplit:"Z",lockLinesplit:"",respawn:"",toggleAutoRespawn:"",stopMovement:"",toggleSkins:"",toggleNames:"",toggleMass:"",spectateLock:"Q",selectPlayer:"MOUSE1",saveReplay:"R",toggleChat:"",toggleChatToast:"",toggleHud:"",zoomLevel1:"1",zoomLevel2:"2",zoomLevel3:"3",zoomLevel4:"4",zoomLevel5:"5",switchMultibox:""};const d=s.g.keyboard=new class{constructor(){this.version=2,this.pressed=new Map,this.released=new Map,this.hotkeys=null,this.resetObsoleteHotkeys(),this.load()}resetObsoleteHotkeys(){+localStorage.getItem("hotkeysVersion")!==this.version&&(localStorage.setItem("hotkeysVersion",this.version),localStorage.getItem("hotkeys")&&localStorage.removeItem("hotkeys"))}load(){try{const e=JSON.parse(localStorage.getItem("hotkeys"));if("object"!=typeof e)throw new Error("Parsing hotkeys failed, opting to defaults");for(const t in h)t in e||(e[t]=h[t]);this.hotkeys=e}catch(e){a(2,"string"==typeof e?e:e&&e.message||"Error occurred while parsing hotkeys"),this.hotkeys={...h}}this.loadHandlers(this.hotkeys)}save(){localStorage.setItem("hotkeys",JSON.stringify(this.hotkeys))}reset(){return localStorage.removeItem("hotkeys"),this.load(),this.hotkeys}get(){return this.hotkeys}set(e,t){if(!l.has(e))return!1;if(this.hotkeys[e]===t)return!0;if(t)for(const e of Object.entries(this.hotkeys))e[1]===t&&(this.hotkeys[e[0]]="");return this.hotkeys[e]=t,this.save(),this.loadHandlers(this.hotkeys),!0}loadHandlers(e){this.pressed.clear();for(const t in e){if(!l.has(t)){a(1,`Invalid handler name '${t}' in hotkeys`);continue}const s=e[t],i=l.get(t);this.pressed.set(s,i)}this.released.clear(),"feedMacro"in e&&this.released.set(e.feedMacro,n.feed.bind(n,!1))}press(e){if(!this.pressed.has(e))return!1;return this.pressed.get(e)(),!0}release(e){if(!this.released.has(e))return;this.released.get(e)()}convertKey(e){return e?e.toString().toUpperCase().replace(/^(LEFT|RIGHT|NUMPAD|DIGIT|KEY)/,""):"Unknown"}};e.exports=d},5315:(e,t,s)=>{const i=s(3915),{logEvent:n}=s(4909);const o=new class{constructor(){this.players=new Map,this.playersRemoving=[],this.botCount=0}reset(){this.players.forEach(((e,t)=>this.remove(t))),this.botCount=0,this.playersRemoving.splice(0,this.playersRemoving.length)}getPlayer(e){const{players:t}=this;return t.has(e)?t.get(e):null}set({pid:e,nickname:t,skin:s,skinUrl:o,nameColor:r,tagId:a,bot:l}){let h;n(0,e,t,s,o,r,a,!!l),this.players.has(e)?h=this.players.get(e):(this.players.set(e,h=new i(e,!!l)),l&&this.botCount++),s&&(o=`https://skins.vanis.io/s/${s}`);const d=h.setName(t,r),c=h.setSkin(o),p=h.setTagId(a);return(d||c||p)&&h.invalidateVisibility(),h}invalidateVisibility(e){for(const t of this.players.values())e&&e.has(t)||t.invalidateVisibility()}remove(e,t=!1){if(!this.players.has(e))return;if(t)return void this.playersRemoving.push(e);const s=this.players.get(e);s.bot&&this.botCount--,s.destroy(),this.players.delete(e)}sweepRemovedPlayers(){const{playersRemoving:e}=this;for(;e.length;){const t=e.shift();this.remove(t)}}};e.exports=o},3915:(t,s,i)=>{const n=i(9980),o=i(3698),{basic:r,basicd:a}=i(4276),l=i(3832),{logEvent:h}=i(4909),d=o.cellSize,c=o.cellBorderSize,p=e=>{e=e||0;return(new l.Graphics).lineStyle(c,0,.5).beginFill(e).drawCircle(0,0,d/2).endFill()};class u{constructor(e,t){this.pid=e,this.bot=t,this.skinUrl=null,this.tagId=null,this.isMe=e==n.playerId||null,this.texture=l.RenderTexture.create(d,d),this.cellContainer=this.createCellContainer(),this.renderCell(),this.hasCrown,this.nameFromServer,this.nameColorFromServer}get visibility(){return 2-+(n.tagId===this.tagId)}setOutline(t){t=t||0,this.outlineColor=e;const s=o.cellSize/2,i=(new l.Graphics).lineStyle(20,t,1).drawCircle(0,0,s-9.5).endFill();i.pivot.set(-s),n.renderer.render(i,this.texture,!1)}setCrown(e){this.hasCrown=e,n.cells.forEach((t=>{t.pid===this.pid&&(e?t.addCrown():t.removeCrown())}))}createCellContainer(){const e=new l.Container;return e.pivot.set(-d/2),e.addChild(p(this.getCellColor())),e}createSkinSprite(e){const t=new l.BaseTexture(e),s=new l.Texture(t),i=new l.Sprite(s);return i.width=i.height=d,i.anchor.set(.5),i}renderCell(){console.assert(this.cellContainer.children.length<=3,"cellContainer has unexpected sprites"),n.renderer.render(this.cellContainer,this.texture,!0),this.outlineColor&&this.setOutline(this.outlineColor)}setTagId(e){return e=e||null,this.tagId!==e&&(this.tagId=e,!0)}setNameColor(e){return e=e?parseInt(e,16):null,this.nameColor=e,this.nameColorCss=e&&"#"+e.toString(16),e}setName(e,t){return e=e||"Unnamed",(this.nameFromServer!==e||this.nameColorFromServer!==t)&&(this.nameFromServer=e,this.nameColorFromServer=t,this.applyNameToSprite(),!0)}applyNameToSprite(){let e="Unnamed"===this.nameFromServer,t="Long Name"===this.nameFromServer,s=e?"":this.nameFromServer;const i=this.name,r=this.nameColor;let a;if(a=e||t?this.setNameColor(null):this.setNameColor(this.bot?"878787":this.nameColorFromServer),this.setNameSprite(s,a),!e&&!t&&this.nameSprite.texture.width>o.cellLongNameThreshold&&(t=!0,s="Long Name",a=this.setNameColor(null),this.setNameSprite(s,a)),this.name=e?"Unnamed":s,i!==this.name||r!==this.nameColor){const e=a||(this.isMe?16747520:null);n.emit("minimap-create-node",this.pid,s,a,e)}}setNameSprite(e,t){this.nameSprite?this.nameSprite.text=e:this.nameSprite=new l.Text(e,o.nameTextStyle),this.nameSprite.style.fill=t||16777215,this.nameSprite.updateText()}setSkin(e){if((e=e||null)===this.skinUrl)return!1;this.abortSkinLoaderIfExist();return this.destroySkin()&&this.renderCell(),this.skinUrl=e,this.skinShown&&this.loadSkinAndRender(),!0}destroySkin(){return!!this.skinSprite&&(this.skinSprite.mask.destroy(!0),this.skinSprite.destroy(!0),this.skinSprite=null,!0)}loadSkinAndRender(){this.abortSkinLoader&&h(1,"loadSkinAndRender() called while other skin was loading"),this.abortSkinLoaderIfExist(),this.abortSkinLoader=n.skinLoader.loadSkin(this.skinUrl,(e=>{this.skinSprite=this.createSkinSprite(e),this.skinSprite.mask=p(),this.cellContainer.addChild(this.skinSprite.mask,this.skinSprite),this.renderCell()}))}invalidateVisibility(){let e=o.namesEnabled,t=o.skinsEnabled,s=o.massEnabled;this.isMe?(e=o.showOwnName,t=o.showOwnSkin,s=o.showOwnMass):(e=o.showNames>=this.visibility,t=o.showSkins>=this.visibility,s=o.showMass>=this.visibility),e=o.namesEnabled&&e,t=o.skinsEnabled&&t,s=o.massEnabled&&s,t&&!this.skinShown?this.skinSprite?(this.skinSprite.visible=!0,this.renderCell()):this.skinUrl&&this.loadSkinAndRender():!t&&this.skinShown&&(this.abortSkinLoaderIfExist(),this.skinSprite&&(this.skinSprite.visible=!1,this.renderCell())),this.nameShown=e,this.skinShown=t,this.massShown=s,this.nameColorShown=o.showNameColor}abortSkinLoaderIfExist(){this.abortSkinLoader&&(this.abortSkinLoader(),this.abortSkinLoader=null)}getCellColor(){const e=n.seededRandom(this.pid),t=Math.floor(e*r.length);return(this.bot?a:r)[t]}destroy(){this.abortSkinLoaderIfExist(),this.destroySkin(),this.cellContainer.destroy(!0),this.texture.destroy(!0),this.texture.clearedFromCache=!0,this.nameSprite&&(this.nameSprite.destroy(!0),this.nameSprite=null),n.emit("minimap-destroy-node",this.pid),this.destroyed=!0}}u.prototype.destroyed=!1,t.exports=u},3698:(e,t,s)=>{const i=new Map([["useWebGL",!0],["gameResolution",1],["smallTextThreshold",40],["autoZoom",!1],["rememeberEjecting",!0],["autoRespawn",!1],["mouseFreezeSoft",!0],["drawDelay",120],["cameraMoveDelay",150],["cameraZoomDelay",150],["cameraZoomSpeed",10],["replayDuration",8],["showReplaySaved",2],["showNames",2],["showMass",2],["showSkins",1],["showOwnName",!0],["showOwnMass",!0],["showOwnSkin",!0],["showCrown",!0],["foodVisible",!0],["eatAnimation",!0],["showHud",!0],["showLeaderboard",!0],["showServerName",!1],["showChat",!0],["showChatToast",!1],["minimapEnabled",!0],["minimapLocations",!0],["showFPS",!0],["showPing",!0],["showCellCount",!0],["showPlayerScore",!1],["showPlayerMass",!0],["showClock",!1],["showSessionTime",!1],["showPlayerCount",!1],["showSpectators",!1],["showRestartTiming",!1],["showBlockedMessageCount",!0],["filterChatMessages",!0],["clearChatMessages",!0],["backgroundColor","101010"],["borderColor","000000"],["foodColor","ffffff"],["ejectedColor","ffa500"],["cellNameOutlineColor","000000"],["cursorImageUrl",null],["backgroundImageUrl","img/background.png"],["virusImageUrl","img/virus.png"],["cellMassColor","ffffff"],["cellMassOutlineColor","000000"],["cellNameFont","Hind Madurai"],["cellNameWeight",1],["cellNameOutline",2],["cellNameSmoothOutline",!0],["cellLongNameThreshold",750],["cellMassFont","Ubuntu"],["cellMassWeight",2],["cellMassOutline",2],["cellMassTextSize",0],["cellMassSmoothOutline",!0],["shortMass",!0],["showBackgroundImage",!0],["backgroundImageRepeat",!0],["backgroundDefaultIfUnequal",!0],["backgroundImageOpacity",.6],["useFoodColor",!1],["namesEnabled",!0],["skinsEnabled",!0],["massEnabled",!0],["showLocations",!1],["cellBorderSize",1],["autoHideReplayControls",!1],["minimapSize",220],["minimapFPS",30],["minimapSmoothing",.08]]),n=(e,t)=>{let s;switch(e){case 3:s=t/5;break;case 1:s=t/20;break;default:s=t/10}return Math.ceil(s)},o=e=>0==e?"thin":2==e?"bold":"normal";const r=s.g.settings=new class{constructor(){const e=this.storage=new Map,t=this.userDefinedSettings=this.loadUserDefinedSettings();let s;for(s in t){const i=t[s];e.set(s,this[s]=i)}i.forEach(((t,s)=>{e.has(s)||e.set(s,this[s]=t)})),this.set("skinsEnabled",!0),this.set("namesEnabled",!0),this.set("massEnabled",!0),this.cellSize=512,this.compileNameFontStyle(),this.compileMassFontStyle()}compileNameFontStyle(){const e={fontFamily:this.cellNameFont,fontSize:80,fontWeight:o(this.cellNameWeight)};this.cellNameOutline&&(e.stroke=parseInt(this.cellNameOutlineColor,16),e.strokeThickness=n(this.cellMassOutline,e.fontSize),e.lineJoin=this.cellMassSmoothOutline?"round":"miter"),this.nameTextStyle=e}compileMassFontStyle(){const e={fontFamily:this.cellMassFont,fontSize:56+20*this.cellMassTextSize,fontWeight:o(this.cellMassWeigh),lineJoin:"round",fill:parseInt(this.cellMassColor,16)};this.cellMassOutline&&(e.stroke=parseInt(this.cellMassOutlineColor,16),e.strokeThickness=n(this.cellMassOutline,e.fontSize),e.lineJoin=this.cellMassSmoothOutline?"round":"miter"),this.massTextStyle=e}getDefault(e){return i.has(e)?i.get(e):null}loadUserDefinedSettings(){if(!("settings"in localStorage))return{};try{return JSON.parse(localStorage.getItem("settings"))}catch(e){return{}}}has(e){const{storage:t}=this;return t.has(e)}get(e){const{storage:t}=this;return t.has(e)?t.get(e):null}set(e,t){const{storage:s}=this;return(!s.has(e)||s.get(e)!==t)&&(s.set(e,this[e]=t),this.userDefinedSettings[e]=t,localStorage.setItem("settings",JSON.stringify(this.userDefinedSettings)),!0)}};e.exports=r},6412:(e,t,s)=>{const{logEvent:i}=s(4909),n=({callbacks:e},t)=>{const s=e.indexOf(t);s>=0&&e.splice(s,1)};e.exports=class{constructor(){this.loaders=new Map,this.load()}async load(){const e=await fetch(new URL(s(2393),s.b)),t=URL.createObjectURL(await e.blob());i(0,`Skin worker loaded at "${t}"`),this.worker=new Worker(t),this.worker.addEventListener("message",this.onSkinLoaded.bind(this))}createLoader(e){return{image:null,callbacks:[e]}}clearCallbacks(){this.loaders.clear()}loadSkin(e,t){if(!this.loaders.has(e)){const s=this.createLoader(t);return this.loaders.set(e,s),this.worker.postMessage(e),n.bind(null,s,t)}const s=this.loaders.get(e);if(s.image)t(s.image);else if(!s.errored)return s.callbacks.push(t),n.bind(null,s,t);return null}onSkinLoaded(e){const{url:t,image:s,errored:i}=e.data,n=this.loaders.get(t);if(i)n.errored=!0,n.callbacks=[];else{n.image=s;const{callbacks:e}=n;for(;e.length;){e.pop()(s)}}}}},4547:e=>{e.exports={connectionUrl:null,selectedServer:null,spectators:0,allowed:!1,playButtonDisabled:!1,playButtonText:"Play",deathDelay:!1,autoRespawning:!1,alive:!1}},4909:(e,t,s)=>{const i=["INFO","WARNING","ERROR"].map((e=>`[${e}]`)),n=new Map([[0,console.log.bind(null,i.shift())],[1,console.warn.bind(null,i.shift())],[2,console.error.bind(null,i.shift())]]),{default:o}=s(6455);s.g.Swal=o;const r=o.mixin({toast:!0,position:"top",showConfirmButton:!1,showCloseButton:!0});e.exports={lerp:(e,t,s)=>e+(t-e)*s,clampNumber:(e,t,s)=>Math.min(s,Math.max(t,e)),logEvent:(e,...t)=>!!n.has(e)&&(n.get(e)(...t),!0),writeClientData:e=>{e.writeEscapedStringNT("Test"),e.writeEscapedStringNT(""),e.writeEscapedStringNT("https://skins.vanis.io/s/vanis1")},toast:r}},5939:(e,t,s)=>{const i=s(9980);s(3698);s(4893);const n=s(5315),o=s(9202),{wasmModule:r}=s(2550),a=s(8733),{logEvent:l,toast:h}=s(4909),d=s(3832),{createApp:c}=s(3961),p=s(2332).Z;l(0,"Game",i),i.playerManager=n,i.connection=o,i.actions=a,s.g.module=r,"VERSION"in d&&l(0,`Running PIXI v${d.VERSION}`),document.body.addEventListener("contextmenu",(e=>{e.preventDefault()})),h.fire({title:"Hello, world!",icon:"success",timer:2e3});(i.app=c(p)).mount("#app")},9202:(e,t,s)=>{const i=s(9980),n=s(3698),o=s(4547),r=s(5315),{writeClientData:a,logEvent:l,toast:h}=s(4909),{parseInitialData:d,parsePlayers:c}=s(4647),{parseCells:p}=s(2550),u=s(2918),m=s(7053),g=s(2631),w=(e,t)=>{h.fire({icon:t?"error":"info",title:e,timer:t?5e3:2e3})};class y{constructor(){this.ws=null,this.opened=!1,this.socketId=null,this.socketCount=0}open(e){i.running&&i.stop(),this.close(),i.emit("chat-clear"),this.opened=!0;const t=this.ws=new m(e,"tFoL46WDlZuRja7W6qCl");t.binaryType="arraybuffer",t.packetCount=0,t.onopen=()=>{this.opened&&(this.socketId=t.id=this.socketCount++,o.connectionUrl=e,t.onclose=this.onClosed.bind(this))},t.onclose=this.onRejected.bind(this),t.onmessage=this.handleMessage.bind(this)}close(){const{ws:e}=this;e&&(e.onmessage=null,e.onclose=null,e.onerror=null,e.close(),this.ws=null,o.connectionUrl=null,this.opened=!1)}send(e){if(e instanceof g&&(e=e.view),!this.opened)return!1;const{ws:t}=this;return console.assert(!!t,"Socket not defined?"),t.send(e),!0}onClosed(e){let t;if(this.socketId=null,this.opened=!1,i.running&&i.stop(),1003===e.code)t=1500,w("Server restarting...",!1);else{t=3500+~~(100*Math.random());let s="You have been disconnected";e.reason&&(s+=` (${e.reason})`),w(s,!0)}setTimeout((()=>{this.opened||i.emit("reconnect-server")}),t),i.showMenu(!0)}onRejected(){this.socketId=null,this.opened=!1,w("Connection rejected",!0)}handleMessage(e){const t=g.fromBuffer(e.data);switch(t.readUInt8()){case 1:{const e=d(t);return i.start(e),void setTimeout((()=>{if(o.alive)return!1;i.spectating=!0,S.sendOpcode(2)}),1500)}case 2:{const e=new Uint8Array(t.buffer,1);return void this.sendJoinData(new u(e).build())}case 3:{const e=performance.now()-i.pingStamp;return void l(0,`[FRAME #${i.frames}] Ping: ${Math.round(e)}ms | FPS: ${Math.floor(i.ticker.FPS)}`)}case 4:{let e;for(;0!==(e=t.readUInt16LE());)r.remove(e,!0);return}case 6:return void i.connection.sendOpcode(6);case 10:{i.timeStamp=performance.now();const e=p(t);i.cellCount!=e&&(i.emit("cells-changed",e),i.cellCount=e);return(o.alive=0!=e)?i.spectating=!1:o.autoRespawning&&37==++i.ticksSinceDeath&&i.triggerAutoRespawn(),i.updateCamera(!0),void r.sweepRemovedPlayers()}case 16:return void c(t);case 17:{const{camera:e}=i;return void e.spectator.set(t.readInt16LE(),t.readInt16LE())}case 18:return void i.clearCells();case 20:return o.deathDelay=!0,void(n.autoRespawn&&!i.app.showMenu?(o.autoRespawning=!0,i.ticksSinceDeath=0):i.deathTimeout=setTimeout(i.triggerDeathDelay.bind(i),900));case 26:return o.playButtonDisabled=!!t.readUInt8(),void(t.length>t.offset+1&&(o.playButtonText=t.readString()||"Play"));default:return}}sendJoinData(e){const t=/^wss?:\/\/[a-zA-Z0-9_-]+\.vanis\.io/i.test(o.connectionUrl)?localStorage.vanisToken:null,s=g.fromSize(2+e.length+(t?t.length:0));s.writeUInt8(5),s.writeUInt8(i.clientVersion),e.forEach((e=>s.writeUInt8(e))),a(s),t&&s.writeStringNT(t),this.send(s)}sendMouse(){const{x:e,y:t}=i.mouse,s=g.fromSize(5);s.writeUInt8(16),s.writeInt16LE(e),s.writeInt16LE(t),this.send(s)}sendOpcode(e){const t=g.fromSize(1);t.writeUInt8(e),this.send(t)}sendRecaptchaToken(e){const t=g.fromSize(1+(e.length+1));t.writeUInt8(11),t.writeStringNT(e),this.send(t)}sendChatMessage(e){e=unescape(encodeURIComponent(e));const t=g.fromSize(1+e.length);t.writeUInt8(99),t.writeString(e),this.send(t)}}const S=new y;t.Connection=y,e.exports=S},2631:(e,t,s)=>{class i{constructor(e,t){if(this.view=null,e instanceof DataView)this.view=e;else{if(!(e instanceof ArrayBuffer))throw new TypeError("First argument to SmartBuffer constructor must be an ArrayBuffer or DataView");this.view=new DataView(e)}this.offset=t||0}ensureCapacity(e){const t=this.offset+e;if(t>this.length){const e=new ArrayBuffer(t);new Uint8Array(e).set(new Uint8Array(this.buffer)),this.view=new DataView(e)}}static fromSize(e){return new this(new ArrayBuffer(e),0)}static fromBuffer(e){return new this(e,0)}get buffer(){const{view:e}=this;return e?e.buffer:null}toBuffer(){return this.buffer}get length(){const{view:e}=this;return e?e.byteLength:0}get eof(){return this.offset>=this.length}read(e,t,s,i){const n=e.call(this.view,i??this.offset,s);return i||(this.offset+=t),n}write(e,t,s,i){this.ensureCapacity(t),e.call(this.view,this.offset,s,i),this.offset+=t}readInt8(e){return this.read(DataView.prototype.getInt8,1,null,e)}readUInt8(e){return this.read(DataView.prototype.getUint8,1,null,e)}readInt16LE(e){return this.read(DataView.prototype.getInt16,2,!0,e)}readInt16BE(e){return this.read(DataView.prototype.getInt16,2,!1,e)}readUInt16LE(e){return this.read(DataView.prototype.getUint16,2,!0,e)}readUInt16BE(e){return this.read(DataView.prototype.getUint16,2,!1,e)}readInt32LE(e){return this.read(DataView.prototype.getInt32,4,!0,e)}readInt32BE(e){return this.read(DataView.prototype.getInt32,4,!1,e)}readUInt32LE(e){return this.read(DataView.prototype.getUint32,4,!0,e)}readUInt32BE(e){return this.read(DataView.prototype.getUint32,4,!1,e)}readString16(){let e="";for(;;){const t=this.eof?0:this.readUInt16LE();if(0===t)break;e+=String.fromCharCode(t)}return e}readString(){let e="";for(;;){const t=this.eof?0:this.readUInt8();if(0===t)break;e+=String.fromCharCode(t)}return e}readEscapedString(){return decodeURIComponent(escape(this.readString()))}writeInt8(e){this.write(DataView.prototype.setInt8,1,e,null)}writeUInt8(e){this.write(DataView.prototype.setUint8,1,e,null)}writeInt16LE(e){this.write(DataView.prototype.setInt16,2,e,!0)}writeInt16BE(e){this.write(DataView.prototype.setInt16,2,e,!1)}writeUInt16LE(e){this.write(DataView.prototype.setUint16,2,e,!0)}writeUInt16BE(e){this.write(DataView.prototype.setUint16,2,e,!1)}writeInt32LE(e){this.write(DataView.prototype.setInt32,4,e,!0)}writeInt32BE(e){this.write(DataView.prototype.setInt32,4,e,!1)}writeUInt32LE(e){this.write(DataView.prototype.setUint32,4,e,!0)}writeUInt32BE(e){this.write(DataView.prototype.setUint32,4,e,!1)}writeString(e){const t=e.length;this.ensureCapacity(t);for(let s=0;s<t;s++)this.writeUInt8(e.charCodeAt(s))}writeStringNT(e){this.writeString(e),this.writeUInt8(0)}writeEscapedString(e){this.writeString(unescape(encodeURIComponent(e)))}writeEscapedStringNT(e){this.writeStringNT(unescape(encodeURIComponent(e)))}}s.g.SmartBuffer=i,e.exports=i},4647:(e,t,s)=>{const i=s(9980),n=s(5315);s(3915),s(2550),s(2631);e.exports={parseInitialData:e=>{const t={},s=t.border={};if(t.protocol=e.readUInt8(),t.protocol>=4){t.gamemodeId=e.readUInt8(),t.instanceSeed=e.readUInt16LE(),t.playerId=e.readUInt16LE(),s.minx=e.readInt16LE(),s.miny=e.readInt16LE(),s.maxx=e.readInt16LE(),s.maxy=e.readInt16LE();const i=e.readUInt8();s.circle=!!(1&i);const n=t.food={};if(2&i){const t=n.minSize=e.readUInt16LE(),s=n.maxSize=e.readUInt16LE();n.stepSize=s-t}4&i&&(n.ejectedSize=e.readUInt16LE()),s.width=s.maxx-s.minx,s.height=s.maxy-s.miny}else{if(t.protocol>=2)t.gamemodeId=e.readUInt8(),t.instanceSeed=e.readUInt16LE(),t.playerId=e.readUInt16LE(),s.width=e.readUInt32LE(),s.height=e.readUInt32LE();else{t.gamemodeId=1,t.instanceSeed=e.readInt16LE(),t.playerId=e.readInt16LE();const i=e.readUInt16LE();s.width=i,s.height=i}s.minx=-s.width/2,s.miny=-s.height/2,s.maxx=+s.width/2,s.maxy=+s.height/2}return s.x=(s.minx+s.maxx)/2,s.y=(s.miny+s.maxy)/2,t},parsePlayers:e=>{const t=JSON.parse(e.readEscapedString()),s=t.find((e=>e.pid===i.playerId)),o=!!s&&i.setTagId(s.tagId),r=new Set;for(const e of t){const t=n.set(e);r.add(t)}o&&(i.emit("minimap-positions",[]),n.invalidateVisibility(r))}}},2918:e=>{let t;{const e="you skid.";t=[124,24,138,29,216,4,129,66,8].map(((t,s)=>t^e.charCodeAt(s)+s))}e.exports=class{#e;constructor(e){this.#e=e}#t(e,s){const i=this.#e[s],n=i+5&7,o=255&(i<<n|i>>>8-n),r=e[0!=s?s-1:0]^t[s];e.push(o^r^t[8])}build(e=!1){const t=[];for(let e=0;e<8;e++)this.#t(t,e);const s=1+Math.floor(2147483646*Math.random());return t.push(t[0]^s>>24),t.push(t[1]^s>>16),t.push(t[2]^s>>8),t.push(s^t[3]),t.push(t[0]^+e^31),t.map((e=>255&e))}}},7053:(e,t,s)=>{const i=s.g.WebSocket;i.prototype.packetCount=0,delete s.g.WebSocket,e.exports=i},2766:e=>{class t{constructor(e,t){this.x=e||0,this.y=t||0}set(e,s){e instanceof t&&(s=e.y,e=e.x),this.x=e,this.y=s}add(e,s){return e instanceof t&&(s=e.y,e=e.x),this.x+=e,this.y+=s,this}divide(e){return this.x/=e,this.y/=e,this}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}reset(){this.x=this.y=0}copy(){return new t(this.x,this.y)}toString(){return`{${this.x}, ${this.y}}`}toObject(){return[this.x,this.y]}}e.exports=t},9575:(e,t,s)=>{const i=s(3698),n=s(3832);n.utils.skipHello();const o=n.autoDetectRenderer({resolution:i.gameResolution,view:document.getElementById("canvas"),forceCanvas:!i.useWebGL,antialias:!1,powerPreference:"high-performance",backgroundColor:parseInt(i.backgroundColor,16)});["interaction","accessibility"].forEach((e=>{const t=o.plugins[e];t&&(t.destroy(),delete o.plugins[e])}));const r=()=>{o.resize(window.innerWidth,window.innerHeight)};r(),window.addEventListener("resize",r),o.clear(),e.exports=o},2068:(e,t,s)=>{const i=s(3698),n=s(3832),o=e=>{const t=parseInt(i.borderColor,16),{width:s,height:o}=e,r=new n.Graphics;return r.lineStyle(100,t,1,.5),e.circle?r.drawEllipse(s/2,o/2,s/2,o/2):r.drawRect(0,0,s,o),r.endFill(),r.pivot.set(s/2,o/2),r};e.exports=class{constructor(e,t){this.game=e,this.border=t,this.container=new n.Container,this.background=new n.Container,this.foreground=new n.Container,this.food=new n.Container,this.food.visible=i.foodVisible,this.backgroundSprite=null,this.borderSprite=o(t),this.background.addChild(this.borderSprite),this.container.addChild(this.background,this.food,this.foreground),this.resetMassTextStyle(!1),this.setPosition();n.utils.isWebGLSupported()&&i.useWebGL&&i.showBackgroundImage&&this.setBackgroundImage(),this.background.position.x=t.x,this.background.position.y=t.y}setPosition(){const{container:e}=this;e.position.x=window.innerWidth/2,e.position.y=window.innerHeight/2}sort(){this.foreground.children.sort(((e,t)=>(e=e.gameData).size===(t=t.gameData).size?e.id-t.id:e.size-t.size))}addCell(e){this.foreground.addChild(e)}addFood(e){this.food.addChild(e)}setBackgroundImage(){const e=i.backgroundImageUrl;if(!e)return void this.destroyBackgroundImage();const{border:t}=this,s=(i.backgroundImageRepeat?n.TilingSprite:n.Sprite).from(e,{});s.width=t.width,s.height=t.height,s.alpha=i.backgroundImageOpacity,s.anchor.set(.5);const o=this.backgroundSprite;if(o){const e=s.texture!==o.texture;this.destroyBackgroundImage(e)}if(this.backgroundSprite=s,this.background.addChildAt(s,0),t.circle){const{width:e,height:s}=t,i=(new n.Graphics).beginFill(16777215).drawEllipse(e/2,s/2,e/2,s/2).endFill();i.pivot.set(e/2,s/2),this.background.addChildAt(i,1),this.backgroundSprite.mask=i}}destroyBackgroundImage(e){this.backgroundSprite&&(this.backgroundSprite.destroy(!!e),this.backgroundSprite=null)}toggleBackgroundImage(e){e&&!this.backgroundSprite?this.setBackgroundImage():e||this.destroyBackgroundImage(!0)}resetBorder(){this.borderSprite.destroy(),this.borderSprite=o(this.border),this.background.addChild(this.borderSprite)}resetMassTextStyle(e){e&&this.uninstallMassTextFont();const t=i.massTextStyle;n.BitmapFont.from("mass",t,{chars:"1234567890k."})}uninstallMassTextFont(){n.BitmapFont.uninstall("mass")}}},9220:(e,t,s)=>{const i=s(9575),n=s(3698),o=s(3832),{logEvent:r}=s(4909);class a{constructor(){this.cache=new Map,this.textureSize=n.cellSize,this.scaledSize=this.textureSize/2}get(){}reset(){const{cache:e}=this;e.forEach((e=>e.destroy(!0))),e.clear()}}e.exports={circleManager:new class extends a{get(e){const{cache:t}=this;if(t.has(e))return t.get(e);{const{scaledSize:s,textureSize:n}=this,r=(new o.Graphics).beginFill(e).drawCircle(0,0,s).endFill();r.position.set(s);const a=o.RenderTexture.create(n,n);return t.set(e,a),i.render(r,a),a}}},squareManager:new class extends a{get(e){const{cache:t}=this;if(t.has(e))return t.get(e);{const{scaledSize:s,textureSize:n}=this,r=(new o.Graphics).beginFill(e).drawRect(-s,-s,2*s,2*s).endFill();r.position.set(s);const a=o.RenderTexture.create(n,n);return t.set(e,a),i.render(r,a),a}}},virusTexture:new class{constructor(){this.loading,this.texture=o.RenderTexture.create(200,200)}async load(e){if(!this.loading){this.loading=!0;try{const t=await o.Texture.from(e,{width:200,height:200}),s=new o.Sprite.from(t);i.render(s,this.texture,!0),r(0,"Loaded static virus texture")}catch(t){r(1,`Failed to load static virus texture (URL=${e})`)}delete this.loading}}get(){return this.texture}}}},9719:(e,t,s)=>{const i=s(9980),n=s(5315),o=s(3698),{clampNumber:r}=s(4909),{PlayerCell:a,Virus:l,EjectedMass:h,Food:d,DeadCell:c,Crown:p,Coin:u}=s(2049);e.exports={addOrUpdateCell:(e,t,s,o,r,m,g,w)=>{const y=15&e;if(o=32&e?void 0:o,m=64&e?void 0:m,!(3!==y&&4!==y||void 0!==o&&void 0!==m)){const{food:e}=i,t=m=3===y?e.ejectedSize||1:e.minSize+s%e.stepSize||1;if(4==y){const{border:e}=i;o=e.minx+t+(e.width-2*t)*i.seededRandom(65536+s),r=e.miny+t+(e.height-2*t)*i.seededRandom(131072+s)}}const{cells:S}=i;let f;if(S.has(s))f=S.get(s),f.update(),f.ox=f.x,f.oy=f.y,f.oSize=f.size;else{const e={type:y,id:s,pid:t,x:o,y:r,size:m,flags:g};switch(y){case 1:{const s=n.getPlayer(t);e.texture=s.texture,f=new a(e,s);break}case 2:f=new l(e);break;case 3:f=new h(e);break;case 4:f=new d(e);break;case 6:f=new p(e);break;case 9:f=new u(e);break;default:{let t=4210752,s=!1;g>1&&(t=0,128&g&&(t|=7340032),64&g&&(t|=28672),32&g&&(t|=112),16&g&&(s=!0)),f=new c(e,t,s);break}}const{scene:w}=i;w[1&g?"addFood":"addCell"](f.sprite),S.set(s,f)}void 0!==o&&(f.nx=o,f.ny=r),void 0!==m&&(f.nSize=m),f.updateStamp=i.timeStamp;const v=f;return v.pid&&v.pid===i.activePid?1:0},destroyCell:e=>{const{cells:t}=i;t.has(e)&&t.get(e).destroy()},eatCell:(e,t)=>{const{cells:s}=i;if(!s.has(e))return;const n=s.get(e);if(!s.has(t))return n.destroy();const r=s.get(t);n.update(),n.destroy(o.get("eatAnimation")),n.nx=r.nx,n.ny=r.ny,n.nSize=0,n.scale=0,n.updateStamp=i.timeStamp}}},2550:(e,t,s)=>{s(9980);const{addOrUpdateCell:i,destroyCell:n,eatCell:o}=s(9719);const r=new class{async init(){if(this.initializing||this.instance)return!1;this.initializing=!0;const e=await fetch(new URL(s(7992),s.b)),t={env:{addOrUpdate:i,destroy:n,eat:o,emscripten_notify_memory_growth:e=>{}}},r=this.instance=await WebAssembly.instantiate(await WebAssembly.compile(await e.arrayBuffer()),t),{memory:a}=r.exports;return this.HEAPU8=new Uint8Array(a.buffer),this.HEAPU16=new Uint8Array(a.buffer),this.HEAPF32=new Uint8Array(a.buffer),this.HEAPU32=new Uint8Array(a.buffer),delete this.initializing,!0}deserialize(e,t){if(!this.instance)return 0;const{deserialize:s,malloc:i,free:n}=this.instance.exports,o=i(e.byteLength);this.HEAPU8.set(e,o);const r=s(o,t);return n(o),r}};r.init();e.exports={wasmModule:r,parseCells:e=>r.deserialize(new Uint8Array(e.buffer,1),0)}},2426:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});const i=s.p+"img/coin.png"},2332:(e,t,s)=>{"use strict";s.d(t,{Z:()=>O});var i=s(3961);const n={class:"main-container"};const o={class:"player-container"},r={class:"player-data"},a=["value"],l=["value"],h=["value"],d={class:"game-buttons"},c={class:"fas fa-play",style:{"margin-right":"4px","font-size":"0.8rem"}};const p=s(9980),u=s(4547),{logEvent:m}=s(4909),g=s(8733),w={data:()=>({showSettings:!1,showHotkeys:!1,gameState:u,name:localStorage.getItem("nickname")||"",tag:localStorage.getItem("teamtag")||"",skinUrl:"string"==typeof localStorage.skinUrl?localStorage.getItem("skinUrl"):"https://skins.vanis.io/s/vanis1"}),created(){p.on("skin-click",(e=>{this.skinUrl=e}))},methods:{play(e){console.log(e),e instanceof MouseEvent&&e.isTrusted&&(console.log("hi"),u.alive||g.join(),p.showMenu(!1))},spectate(){u.alive||(g.spectate(),p.showMenu(!1))},onNameChanged(){localStorage.setItem("nickname",this.name)},onTagChanged(){localStorage.setItem("teamtag",this.tag)},onSkinUrlChanged(){p.emit("skin-url-edit",this.skinUrl)},captureInput(e,t){if(!e.target.composing){const s=e.target.value;switch(m(0,"capturing input for",t,"=",s),t){case"name":return void(this.name=s);case"tag":return void(this.tag=s);case"skin-url":return void(this.skinUrl=s)}}}}};var y=s(3744);const S=(0,y.Z)(w,[["render",function(e,t,s,n,p,u){return(0,i.openBlock)(),(0,i.createElementBlock)("div",o,[(0,i.createElementVNode)("div",r,[(0,i.createElementVNode)("input",{class:"name",type:"text",spellcheck:"false",placeholder:"Nickname",maxlength:"15",value:p.name,onChange:t[0]||(t[0]=e=>u.onNameChanged()),onInput:t[1]||(t[1]=e=>u.captureInput(e,"name"))},null,40,a),(0,i.createElementVNode)("input",{class:"tag",type:"text",spellcheck:"false",placeholder:"Tag",maxlength:"15",value:p.tag,onChange:t[2]||(t[2]=e=>u.onTagChanged()),onInput:t[3]||(t[3]=e=>u.captureInput(e,"tag"))},null,40,l),(0,i.createElementVNode)("input",{type:"text",spellcheck:"false",placeholder:"https://skins.vanis.io/s/",maxlength:"31",value:p.skinUrl,onChange:t[4]||(t[4]=e=>u.onSkinUrlChanged()),onInput:t[5]||(t[5]=e=>u.captureInput(e,"skinUrl"))},null,40,h),(0,i.createElementVNode)("div",d,[(0,i.createElementVNode)("button",{class:"play-button",disabled:!0,onClick:t[6]||(t[6]=e=>u.play(e))},[(0,i.createElementVNode)("i",c,(0,i.toDisplayString)(p.gameState.playButtonText),1)])])])])}]]),f=s.p+"img/skin-add.png",v={class:"customization"},k={class:"skins"},b=["src","onClick","onContextmenu"],x=["onClick"];const C=s(9980),{logEvent:I}=s(4909),M={data:()=>({selectedSkinIndex:0,skins:[]}),created(){C.on("skin-url-edit",this.onSkinUrlChanged),this.skins=this.loadSkins()||this.getDefaultSkins();const e=+localStorage.getItem("selectedSkinIndex")||0;this.selectSkin(e)},methods:{loadSkins(){try{if(!("skins"in localStorage))return null;const e=JSON.parse(localStorage.getItem("skins"));if(!Array.isArray(e))return I(2,"'localStorage.skins' is not an array!"),null;for(let t=e.length;t<2;t++)e.push("https://skins.vanis.io/s/vanis1");return e}catch(e){return I(2,"Error parsing saved skins",e.message),null}},getDefaultSkins:()=>new Array(8).fill("https://skins.vanis.io/s/vanis1"),onSkinUrlChanged(e){this.$set(this.skins,this.selectedSkinIndex,e),this.saveSkins()},selectSkin(e){this.selectedSkinIndex=e,localStorage.setItem("selectedSkinIndex",e);const t=this.skins[e];C.emit("skin-click",t)},removeSkin(e){this.skins.splice(e,1),this.skins.length<2&&this.skins.push("https://skins.vanis.io/s/vanis1"),this.saveSkins();const t=Math.max(0,this.selectedSkinIndex-1);this.selectSkin(t)},addSkin(){const e=this.skins.length;this.skins.push("https://skins.vanis.io/s/vanis1"),this.selectSkin(e),this.saveSkins()},saveSkins(){localStorage.setItem("skins",JSON.stringify(this.skins))}}},E=(0,y.Z)(M,[["render",function(e,t,s,n,o,r){return(0,i.openBlock)(),(0,i.createElementBlock)("div",v,[(0,i.createElementVNode)("div",k,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(o.skins,((e,t)=>((0,i.openBlock)(),(0,i.createElementBlock)("li",null,[((0,i.openBlock)(),(0,i.createElementBlock)("span",{key:t,class:"skin-container"},[(0,i.createElementVNode)("img",{class:(0,i.normalizeClass)(["skin",{selected:o.selectedSkinIndex===t}]),src:e,alt:"",onClick:e=>r.selectSkin(t),onContextmenu:e=>r.removeSkin(t)},null,42,b),(0,i.createElementVNode)("i",{class:"fas fa-times skin-remove-button",onClick:e=>r.removeSkin(t)},null,8,x)]))])))),256)),(0,i.createElementVNode)("img",{class:"skin add-skin",src:f,alt:"",onClick:t[0]||(t[0]=e=>r.addSkin())})])])}]]),U=s(9980),T=s(3698),L={data:()=>({cursorStyleElem:null}),methods:{setCursorUrl(e){let t=e?`#canvas, #hud > * { cursor: url('${e}'), auto !important; }`:null,s=this.cursorStyleElem;!t&&s?(s.remove(),s=null):t&&!s&&(s=document.createElement("style"),document.head.appendChild(s)),s&&(s.innerHTML=t)}},components:{skins:E,playerContainer:S},created(){U.on("set-cursor-url",(e=>this.setCursorUrl(e)))},mounted(){this.setCursorUrl(T.get("cursorImageUrl"))}},z=(0,y.Z)(L,[["render",function(e,t,s,o,r,a){const l=(0,i.resolveComponent)("skins"),h=(0,i.resolveComponent)("playerContainer");return(0,i.openBlock)(),(0,i.createElementBlock)("div",n,[(0,i.createVNode)(l,{class:"fade-box"}),(0,i.createVNode)(h,{class:"fade-box two"})])}]]),D=s(3698),N={data:()=>({showHud:D.get("showHud"),showMenu:!0,showDeathScreen:!1,deathStats:null}),components:{mainContainer:z}},O=(0,y.Z)(N,[["render",function(e,t,s,n,o,r){const a=(0,i.resolveComponent)("main-container");return(0,i.withDirectives)(((0,i.openBlock)(),(0,i.createBlock)(a,null,null,512)),[[i.vShow,o.showMenu]])}]])},2393:(e,t,s)=>{"use strict";e.exports=s.p+"2b9212cb082f16628d4e.js"},7992:(e,t,s)=>{"use strict";e.exports=s.p+"2f01f2fc4a8823712d15.wasm"}},i={};function n(e){var t=i[e];if(void 0!==t)return t.exports;var o=i[e]={id:e,loaded:!1,exports:{}};return s[e].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.m=s,t=[],n.O=(e,s,i,o)=>{if(!s){var r=1/0;for(d=0;d<t.length;d++){for(var[s,i,o]=t[d],a=!0,l=0;l<s.length;l++)(!1&o||r>=o)&&Object.keys(n.O).every((e=>n.O[e](s[l])))?s.splice(l--,1):(a=!1,o<r&&(r=o));if(a){t.splice(d--,1);var h=i();void 0!==h&&(e=h)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[s,i,o]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.p="./",(()=>{n.b=document.baseURI||self.location.href;var e={179:0};n.O.j=t=>0===e[t];var t=(t,s)=>{var i,o,[r,a,l]=s,h=0;if(r.some((t=>0!==e[t]))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(l)var d=l(n)}for(t&&t(s);h<r.length;h++)o=r[h],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(d)},s=self.webpackChunkvanis_client=self.webpackChunkvanis_client||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),n.O(void 0,[736],(()=>n(6981)));var o=n.O(void 0,[736],(()=>n(5939)));o=n.O(o)})();